# Pages模块文档

## 概述

Pages模块包含了应用程序的主要页面组件，实现了知识库管理、文件上传处理和AI写作辅助等核心功能。这些页面通过Streamlit框架构建，提供了直观的用户界面，使用户能够方便地与系统交互。

## 核心组件

### 知识库管理 (CollectionManage.py)
- 实现知识库的创建、删除和管理功能
- 提供知识库参数配置界面
- 支持用户权限管理

### 文件上传 (FileUpload.py)
- 支持多种文件格式的上传和处理
- 实现文献解析和知识库导入
- 支持引用树构建功能

### AI写作助手 (WriteAssistant.py)
- 提供基于知识库的写作辅助功能
- 支持项目管理和对话历史
- 实现文件上传和知识库调用

## 详细功能

### 知识库管理 (CollectionManage.py)

#### 主要功能
1. **知识库信息查看**
   - 显示知识库中的向量数据数量
   - 展示字段结构和类型信息
   - 提供知识库元数据查看

2. **知识库配置**
   - 支持修改知识库标题
   - 控制知识库对普通用户的可见性
   - 提供危险操作(如删除知识库)的安全确认机制

3. **新建知识库**
   - 支持设置知识库名称、语言和描述
   - 提供向量库参数高级配置
   - 支持多种索引类型选择(IVF_FLAT, HNSW等)

4. **用户管理**
   - 显示系统用户列表
   - 支持新建用户功能
   - 提供用户信息更新界面

#### 技术实现
- 使用Streamlit的tabs组件分离不同功能区域
- 通过MilvusConnection管理向量数据库连接
- 使用ProfileStore管理用户信息
- 实现权限控制，限制非管理员用户访问

### 文件上传 (FileUpload.py)

#### 主要功能
1. **Markdown文件处理**
   - 支持批量上传Markdown文件
   - 自动提取文献元数据
   - 支持构建引用树功能

2. **PDF文件处理**
   - 通过Grobid解析PDF文献结构
   - 自动提取文献元数据和引用信息
   - 支持文件分类存储和管理

3. **PMC文献下载**
   - 通过PMC ID直接下载文献
   - 自动解析XML格式文献
   - 支持引用树构建

4. **引用树构建**
   - 分析文献引用关系
   - 自动下载引用文献
   - 构建文献知识网络

#### 技术实现
- 使用tabs组件分离不同文件处理流程
- 实现进度条显示上传和处理进度
- 通过外部工具(Grobid, PMC API)解析文献
- 使用SqliteDocStore和Milvus存储文档和向量数据

### AI写作助手 (WriteAssistant.py)

#### 主要功能
1. **项目管理**
   - 支持创建和切换项目
   - 提供时区设置
   - 自动创建项目相关资源(向量库、文件夹等)

2. **对话管理**
   - 支持创建新对话
   - 提供对话历史浏览
   - 实现对话自动摘要功能

3. **写作辅助**
   - 基于知识库的问答功能
   - 支持文件上传和参考
   - 提供风格仿写和自动纠错功能(待实现)

4. **用户体验**
   - 根据用户权限显示不同界面
   - 提供直观的项目和对话切换
   - 实现流式输出回答

#### 技术实现
- 使用SQLChatMessageHistory存储对话历史
- 通过ProfileStore管理用户项目和对话
- 实现基于LangChain的写作辅助功能
- 使用UUID生成唯一会话标识

## 页面交互流程

### 知识库管理流程
1. 用户选择知识库管理标签页
2. 查看或修改现有知识库信息
3. 创建新知识库或管理用户权限
4. 系统更新配置并反馈操作结果

### 文件上传流程
1. 用户选择文件类型标签页(Markdown/PDF/PMC)
2. 选择目标知识库和是否构建引用树
3. 上传文件或输入PMC ID
4. 系统处理文件并导入知识库
5. 显示处理进度和结果反馈

### 写作助手流程
1. 用户登录并选择或创建项目
2. 系统加载项目相关资源和对话历史
3. 用户输入问题或上传参考文件
4. 系统生成回答并更新对话历史
5. 用户可创建新对话或总结现有对话

## 用户权限控制

系统实现了基于用户组的权限控制:
- **管理员(ADMIN)**: 可访问所有功能，包括知识库管理和用户管理
- **写作者(WRITER)**: 可使用写作助手功能，管理自己的项目
- **普通用户(USER)**: 只能访问被设置为可见的知识库

## 技术栈

- **前端框架**: Streamlit
- **数据存储**: SQLite(用户数据、对话历史)、Milvus(向量数据)
- **文件处理**: Grobid(PDF解析)、PMC API(文献下载)
- **AI集成**: LangChain(RAG实现)、OpenAI API(大语言模型)
